<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>記帳設定｜SuperTool</title>

  <!-- 路徑注意：此檔位於 admin/ -->
  <link rel="icon" type="image/png" href="../assets/img/supertool-favicon.png" />
  <link rel="stylesheet" href="../assets/css/style.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <style>
    /* ───────── 頂部導覽列 ───────── */
    .top{
      background:#17202a; color:#fff; padding:.6rem 1rem;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid #2b313a; position:sticky; top:0; z-index:50;
    }
    .brand{ display:flex; align-items:center; gap:.5rem; color:#fff; text-decoration:none; font-weight:800; }
    .brand img{ height:28px; }
    .top .nav button,.top .nav .btn{ margin-right:.35rem; }

    /* 手機漢堡 */
    .hamburger{ display:none; width:40px;height:34px;border:1px solid #2b313a;border-radius:8px;background:#111722;cursor:pointer;margin-left:8px; }
    .hamburger span{ display:block;height:4px;margin:5px 7px;background:#fff;border-radius:999px;transition:.25s; }
    .hamburger.active span:nth-child(1){ transform:translateY(9px) rotate(45deg); }
    .hamburger.active span:nth-child(2){ opacity:0; }
    .hamburger.active span:nth-child(3){ transform:translateY(-9px) rotate(-45deg); }
    @media (max-width: 992px){
      .hamburger{ display:inline-block; }
      .top .nav{
        display:none; position:absolute; left:0; right:0; top:100%;
        background:#17202a; border-top:1px solid #2b313a; padding:12px;
        box-shadow:0 10px 30px rgba(0,0,0,.35);
      }
      .top .nav.open{
        display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:8px;
      }
      .top .nav .btn,.top .nav button{ width:100%; border-radius:10px; }
    }

    /* ───────── 背景漸層 ───────── */
    .gradient-wrap{
      background: linear-gradient(135deg,#1e3a8a 0%,#2563eb 20%,#7e22ce 40%,#db2777 60%,#f97316 80%,#fde047 100%);
      background-size:300% 300%;
      animation: gradientShift 10s ease-in-out infinite;
      min-height:100vh; padding-bottom:56px;
    }
    @keyframes gradientShift{
      0%{ background-position:0% 50% } 50%{ background-position:100% 50% } 100%{ background-position:0% 50% }
    }

    /* ───────── 版面：左側 / 右側 ───────── */
    .settings-shell{
      max-width:1200px; margin:0 auto; padding:28px 16px;
      display:grid; grid-template-columns: 280px 1fr; gap:22px;
    }
    @media (max-width:992px){ .settings-shell{ grid-template-columns:1fr; } }

    /* 左側半透明面板 */
    .side-panel{
      backdrop-filter: blur(6px);
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.08);
      border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,.25);
      color:#fff; overflow:hidden;
    }
    .side-title{ padding:14px 16px; font-weight:800; font-size:18px; border-bottom:1px solid rgba(255,255,255,.08); }
    .side-menu{ list-style:none; margin:0; padding:8px; }
    .side-menu li{ margin:6px 0; }
    .side-menu a{
      display:block; padding:10px 12px; border-radius:8px; color:#e5e7eb; text-decoration:none;
      background: rgba(255,255,255,.04); transition: background .25s;
    }
    .side-menu a:hover{ background: rgba(255,255,255,.08); }
    .side-menu a.active{ background:#2563eb; color:#fff; }

    /* 右側卡片 */
    .content-card{
      background: linear-gradient(145deg,#0f172a,#1e293b);
      color:#fff; border:2px solid transparent;
      border-image: linear-gradient(90deg,#60a5fa,#a855f7,#f472b6) 1;
      border-radius:14px; padding:20px; box-shadow:0 8px 26px rgba(0,0,0,.45);
    }
    .content-card h2{
      margin:0 0 8px 0; font-size:22px; font-weight:800;
      background: linear-gradient(90deg,#60a5fa,#a855f7,#f472b6);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    .page-slot{ display:grid; gap:16px; }

    /* 🔒 把內頁那排小頁籤藏起來，但功能依舊可在 JS 內觸發 */
    #app .nav.nav-tabs,
    #app .nav.nav-pills,
    #app .quick-tabs,
    #app .mode-switch,
    #app .subtabs { display:none !important; }
  </style>
</head>
<body>

  <!-- 頂部導覽 -->
  <header class="top">
    <a class="brand" href="../index.html#dashboard">
      <img src="../assets/img/supertool-favicon.png" alt="SuperTool">
      <span>SuperTool</span>
    </a>

    <button id="menuToggle" class="hamburger" aria-label="開啟選單" aria-controls="mainNav" aria-expanded="false">
      <span></span><span></span><span></span>
    </button>

    <nav class="nav" id="mainNav">
      <button onclick="location.href='../index.html#dashboard'">首頁</button>
      <button onclick="location.href='../index.html#auth'">帳號</button>
      <button onclick="location.href='../book.html'">記帳</button>
      <button onclick="location.href='./accounting-settings.html#ledgers'">我的</button>
      <button onclick="location.href='../index.html#acct_detail'">明細</button>
      <button onclick="location.href='../index.html#acct_analysis'">分析</button>
      <button onclick="location.href='../cart-demo.html'">購物</button>
      <button onclick="location.href='../index.html#admin'">後台</button>
      <button onclick="location.href='../index.html#settings'">設定</button>
      <button onclick="location.href='../index.html#backup'">備份</button>
      <button class="btn btn-primary" onclick="location.href='../stock/stocks.html'">股票</button>
      <button class="btn btn-outline-light" onclick="alert('聯絡我們：之後可串接表單')">聯絡我們</button>
    </nav>
  </header>

  <!-- 主要背景 -->
  <div class="gradient-wrap">
    <div class="settings-shell">

      <!-- 左側選單 -->
      <aside class="side-panel">
        <div class="side-title">記帳設定</div>
        <ul class="side-menu" id="sideMenu">
          <li><a href="#ledgers" class="active" data-key="ledgers">管理帳本</a></li>
          <li><a href="#budget"  data-key="budget">管理預算</a></li>
          <li><a href="#currency" data-key="currency">管理貨幣</a></li>
          <li><a href="#categories" data-key="categories">管理類型</a></li>
          <li><a href="#chat" data-key="chat">聊天設定</a></li>
          <li><a href="#general" data-key="general">一般設定</a></li>
        </ul>
      </aside>

      <!-- 右側內容 -->
      <main class="page-slot">
        <section class="content-card">
          <h2>聊天設定</h2>
          <div id="app"></div>
        </section>
      </main>

    </div>
  </div>

  <!-- 既有 SPA 腳本（不要動） -->
  <script type="module" src="../assets/js/pages/accounting-settings.js"></script>

  <script>
    /* 手機：漢堡開關（原樣保留） */
    (function(){
      const toggle = document.getElementById('menuToggle');
      const nav = document.getElementById('mainNav');
      if(!toggle || !nav) return;
      const mq = window.matchMedia('(max-width: 992px)');
      function closeMenu(){
        nav.classList.remove('open');
        toggle.classList.remove('active');
        toggle.setAttribute('aria-expanded','false');
      }
      toggle.addEventListener('click', ()=>{
        const opened = nav.classList.toggle('open');
        toggle.classList.toggle('active', opened);
        toggle.setAttribute('aria-expanded', opened ? 'true' : 'false');
      });
      window.addEventListener('resize', ()=>{ if(!mq.matches) closeMenu(); });
      document.addEventListener('click', (e)=>{
        if (!mq.matches) return;
        if (e.target === toggle || toggle.contains(e.target)) return;
        if (!nav.contains(e.target)) closeMenu();
      });
    })();

    /* 左側選單 → 觸發右側 #app 內原本的「那排按鈕/頁籤」 */
    (function(){
      const menu = document.getElementById('sideMenu');
      const app  = document.getElementById('app');

      // 依 key 對應 #app 內按鈕文字（盡量寬鬆匹配）
      const textMap = {
        ledgers:   /管理帳本|帳本/i,
        budget:    /管理預算|預算/i,
        currency:  /貨幣|匯率/i,
        categories:/管理類型|分類|類型/i,
        chat:      /聊天設定|聊天/i,
        general:   /一般設定|一般/i
      };

      // 找到 #app 內對應的按鈕/頁籤並點擊
      function clickInsideAppByKey(key){
        const re = textMap[key];
        if(!re) return;

        // 候選：按鈕/連結/頁籤
        const candidates = app.querySelectorAll('button, a, [role="tab"], .tab, .pill');
        for (const el of candidates){
          const t = (el.textContent || '').trim();
          if (re.test(t)){
            el.click();
            return true;
          }
        }
        return false;
      }

      // 更新左側 active 樣式
      function setActiveKey(key){
        menu.querySelectorAll('a').forEach(a=>{
          a.classList.toggle('active', a.dataset.key===key);
        });
      }

      // 左側點擊 → 觸發 #app 對應行為
      menu.addEventListener('click', (e)=>{
        const a = e.target.closest('a[data-key]');
        if(!a) return;
        e.preventDefault();
        const key = a.dataset.key;
        // 設 hash（若你的 SPA 會用到）
        location.hash = '#'+key;
        setActiveKey(key);
        // 嘗試點擊 #app 內對應控制
        if (!clickInsideAppByKey(key)){
          // 如果 #app 還沒渲染好，等一下再試
          setTimeout(()=>clickInsideAppByKey(key), 120);
        }
      });

      // 監看 #app 內容變動（渲染完成後再綁一次）
      const mo = new MutationObserver(()=> {
        const key = (location.hash||'').replace('#','') || 'ledgers';
        clickInsideAppByKey(key);
        setActiveKey(key);
      });
      mo.observe(app, { childList:true, subtree:true });

      // 首次進入：依 hash 或預設 ledgers
      window.addEventListener('load', ()=>{
        const key = (location.hash||'').replace('#','') || 'ledgers';
        setActiveKey(key);
        setTimeout(()=>clickInsideAppByKey(key), 150);
      });
      window.addEventListener('hashchange', ()=>{
        const key = (location.hash||'').replace('#','') || 'ledgers';
        setActiveKey(key);
        setTimeout(()=>clickInsideAppByKey(key), 80);
      });
    })();
  </script>
</body>
</html>
