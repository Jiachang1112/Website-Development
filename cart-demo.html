<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SuperToolï½œç·šä¸Šä¸‹å–® Demo</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <style>
    :root{
      --bg-dark: #0f141a;
      --text-dark: #eef2f7;
      --muted-dark: #c7d1de;
      --card-dark: #1b222c;
      --border-dark: #2b313a;
      --panel-dark: #17202a;
      --line-dark: #3f4b5b;

      --bg-light: #f5f7fb;
      --text-light: #111;
      --card-light: #fff;
      --border-light: #ddd;

      --accent: #60a5fa;
      --accent-2: #93c5fd;
    }

    html{ background:var(--bg-dark); height:100% }
    body{
      background:var(--bg-dark);
      color:var(--text-dark);
      min-height:100vh;
    }

    /* ====== èˆ‡é¦–é ç›¸åŒçš„å°è¦½åˆ—ï¼ˆæ¡Œæ©Ÿä¸€æ’ã€æ‰‹æ©Ÿé€²æ¼¢å ¡ï¼‰ ====== */
    .top{
      background: var(--panel-dark);
      color: #fff;
      padding: .6rem 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border-dark);
      position: sticky;
      top: 0;
      z-index: 30;
    }
    .brand{ color: inherit; text-decoration: none; font-weight: 700; font-size: 20px; display:flex; align-items:center; gap:10px; }
    .brand img{ height:36px; width:auto; }
    .nav button, .nav a.btnlike{
      margin-right:.4rem;
      border:none;
      background:#1e293b;
      color:#fff; padding:.4rem .8rem; border-radius:999px; cursor:pointer;
      text-decoration:none; display:inline-block;
    }
    .nav button:hover, .nav a.btnlike:hover{ background:#334155; color:#fff; }
    .nav .gap{ display:inline-block; width:10px; }

    /* æ‰‹æ©Ÿæ¼¢å ¡ */
    .hamburger{ display:none; position:relative; width:40px; height:34px; border:1px solid var(--border-dark); border-radius:8px; background:#111722; cursor:pointer; margin-left:8px; }
    .hamburger span{ display:block; height:4px; margin:5px 7px; background:#fff; border-radius:999px; transition:transform .25s ease, opacity .2s ease; }
    .hamburger.active span:nth-child(1){ transform:translateY(9px) rotate(45deg); }
    .hamburger.active span:nth-child(2){ opacity:0; }
    .hamburger.active span:nth-child(3){ transform:translateY(-9px) rotate(-45deg); }

    @media (max-width: 768px){
      .hamburger{ display:inline-block; }
      .top .nav{
        display:none;
        position:absolute; left:0; right:0; top:100%;
        background: var(--panel-dark);
        border-top:1px solid var(--border-dark);
        padding:12px;
        box-shadow:0 10px 30px rgba(0,0,0,.35);
      }
      .top .nav.open{
        display:grid;
        grid-template-columns: repeat(3, minmax(0,1fr));
        gap:8px;
      }
      .top .nav.open .gap{ display:none; }
      .top .nav.open button,
      .top .nav.open .btnlike{
        width:100%;
        justify-content:center;
        border-radius:10px;
      }
    }

    /* ==== ä¿ç•™åŸè³¼ç‰©é é¢¨æ ¼ ==== */
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
    .card{background:var(--card-dark);border:1px solid var(--border-dark);border-radius:12px}
    .card .fw-semibold{ color:#f7f9fc }
    .card .text-muted{ color:var(--muted-dark) !important }
    .price{font-weight:700;color:#e9eef5}

    .btn{border:1px solid #556073;background:#1d2433;color:#eef2f7}
    .btn:hover{ background:#243047; border-color:#6a7892; color:#fff }
    .btn:disabled{opacity:.6;cursor:not-allowed}

    .btn-primary{
      background: var(--accent);
      border-color: var(--accent);
      color:#0a0f14;
      font-weight:700;
    }
    .btn-primary:hover{
      background: var(--accent-2);
      border-color: var(--accent-2);
      color:#0a0f14;
    }

    .btn-outline-light{
      color:#e7edf5;
      border-color:#8aa0b7;
    }
    .btn-outline-light:hover{
      background:#2b3542;
      color:#fff;
      border-color:#9fb2c6;
    }

    .aside{position:sticky;top:16px}
    @media (max-width: 991px){.aside{position:static}}

    .cart-box{
      background: var(--panel-dark);
      border:1px solid var(--border-dark);
      color:#e9edf3;
    }
    body .text-muted,
    body .text-secondary,
    body .text-body-secondary{ color: var(--muted-dark) !important; }
    .cart-item{ border-bottom:1px solid var(--line-dark) }
    .cart-box hr{ border-color:var(--line-dark); opacity:1 }
    #subtotal, #shipping, #total{ color:#ffffff !important; font-weight:800 }

    body.light{ background:var(--bg-light); color:var(--text-light) }
    html.light{ background:var(--bg-light) }
    body.light .card{ background:var(--card-light); border:1px solid var(--border-light) }
    body.light .btn{ background:#f0f0f0; color:#111; border:1px solid #ccc }
    body.light .btn-primary{ background:#0d6efd; border-color:#0d6efd; color:#fff }
    body.light .btn-primary:hover{ background:#0b5ed7; border-color:#0a58ca }
    body.light .text-muted,
    body.light .text-secondary,
    body.light .text-body-secondary{ color:#6b7280 !important }
    body.light #subtotal, body.light #shipping, body.light #total{ color:#111 !important }
    body.light .cart-item{ border-bottom:1px solid #e7e7e7 }
    body.light .cart-box{ background:#fff }
    body.light .cart-box hr{ border-color:#e7e7e7 }

    body:not(.light) .modal-content {
      background: #f8fafc !important;
      color: #000 !important;
      border: 1px solid #2b313a;
      box-shadow: 0 0 20px rgba(0,0,0,0.4);
    }
    body:not(.light) .modal-header,
    body:not(.light) .modal-footer { border-color: #2b313a !important; }
    body:not(.light) .modal-content label,
    body:not(.light) .modal-content input,
    body:not(.light) .modal-content select,
    body:not(.light) .modal-content textarea,
    body:not(.light) .modal-content .form-label,
    body:not(.light) .modal-content .form-select option,
    body:not(.light) .modal-content .modal-title { color: #000 !important; }

    /* ====== è·Ÿé¦–é ä¸€æ¨£çš„å¤šè‰²å‹•æ…‹æ¼¸å±¤ï¼ˆåªåœ¨å°è¦½åˆ—ä¸‹æ–¹ï¼‰ ====== */
    .gradient-wrap{
      background: linear-gradient(135deg,
        #1e3a8a 0%,
        #2563eb 20%,
        #7e22ce 40%,
        #db2777 60%,
        #f97316 80%,
        #fde047 100%
      );
      background-size: 300% 300%;
      animation: gradientShift 10s ease-in-out infinite;
      min-height: calc(100vh - 64px);
      padding-bottom: 64px;
    }
    @keyframes gradientShift{
      0%{ background-position: 0% 50%; }
      50%{ background-position: 100% 50%; }
      100%{ background-position: 0% 50%; }
    }

    /* ====== å½©è‰²å•†å“å¡èˆ‡å½ˆè·³æ•ˆæœ ====== */
    .st-colored-card{ color:#fff; border: none; box-shadow:0 6px 18px rgba(0,0,0,.25); transition: transform .22s ease, box-shadow .22s ease, filter .22s ease; }
    .st-colored-card:hover{ transform: translateY(-4px); box-shadow:0 14px 28px rgba(0,0,0,.35); filter: saturate(1.05); }
    .st-g1{ background: linear-gradient(135deg,#2563eb,#60a5fa); }
    .st-g2{ background: linear-gradient(135deg,#10b981,#34d399); }
    .st-g3{ background: linear-gradient(135deg,#f59e0b,#fbbf24); color:#1f2937; }
    .st-g4{ background: linear-gradient(135deg,#9333ea,#c084fc); }
    .st-g5{ background: linear-gradient(135deg,#db2777,#f472b6); }
    .st-g6{ background: linear-gradient(135deg,#0ea5e9,#22d3ee); }
    .st-g7{ background: linear-gradient(135deg,#ef4444,#f97316); }
    .st-g8{ background: linear-gradient(135deg,#14b8a6,#84cc16); }
    .st-colored-card .fw-semibold{ color:inherit }
    .st-colored-card .price{ color:#fff; text-shadow:0 1px 0 rgba(0,0,0,.25) }
    .st-g3 .price{ color:#1f2937 } /* é»ƒè‰²å¡ç‰‡ä¸Šçš„æ·±è‰²å­—æ›´æ¸…æ¥š */

    /* ğŸ›’ å½©è‰²è³¼ç‰©è»Šå¡ç‰‡åœ¨å½©è‰²åº•çš„ç´°ç¯€ï¼ˆè®“å­—èˆ‡æŒ‰éˆ•æ›´æ¸…æ¥šï¼‰ */
    .cart-box.st-colored-card .text-muted{ color:rgba(255,255,255,.88)!important; }
    .cart-box.st-colored-card hr{ border-color:rgba(255,255,255,.35); }
    .cart-box.st-colored-card .btn{ background:rgba(0,0,0,.18); border-color:rgba(255,255,255,.35); color:#fff; }
    .cart-box.st-colored-card .btn:hover{ background:rgba(0,0,0,.28); border-color:rgba(255,255,255,.55); }
  </style>
</head>
<body>

  <!-- âœ… èˆ‡é¦–é ä¸€è‡´çš„å°è¦½åˆ— -->
  <header class="top">
    <a href="./index.html#dashboard" class="brand">
      <img src="assets/img/supertool-logo.png" alt="SuperTool">
    </a>

    <!-- æ‰‹æ©Ÿç‰ˆæ¼¢å ¡ -->
    <button id="menuToggle" class="hamburger" aria-label="é–‹å•Ÿé¸å–®" aria-controls="mainNav" aria-expanded="false">
      <span></span><span></span><span></span>
    </button>

    <nav class="nav" id="mainNav">
      <!-- é€™è£¡ç”¨é€£çµï¼ˆè³¼ç‰©é ä¸èµ° SPAï¼‰ï¼Œæ¨£å¼åšæˆæŒ‰éˆ•å¤–è§€ -->
      <a class="btnlike" href="./index.html#dashboard">é¦–é </a>
      <a class="btnlike" href="./index.html#auth">å¸³è™Ÿ</a>
      <a class="btnlike" href="./book.html">è¨˜å¸³</a>
      <a class="btnlike" href="./admin/accounting-settings.html#ledgers">æˆ‘çš„</a>
      <a class="btnlike" href="./index.html#acct_detail">æ˜ç´°</a>
      <a class="btnlike" href="./index.html#acct_analysis">åˆ†æ</a>
      <a class="btnlike" href="./cart-demo.html">è³¼ç‰©</a>
      <a class="btnlike" href="./index.html#admin">å¾Œå°</a>
      <a class="btnlike" href="./index.html#settings">è¨­å®š</a>
      <a class="btnlike" href="./index.html#backup">å‚™ä»½</a>
      <a class="btnlike" href="./stock/stocks.html">è‚¡ç¥¨</a>
      <span class="gap"></span>
      <button id="toggleTheme" class="btnlike">åˆ‡æ›äº®/æš—</button>
      <a class="btnlike" href="./index.html#contact" id="goContact">è¯çµ¡æˆ‘å€‘</a>
    </nav>
  </header>

  <!-- ğŸ”½ å°‡ä¸»è¦å…§å®¹åŒ…åœ¨èˆ‡é¦–é ç›¸åŒçš„æ¼¸å±¤èƒŒæ™¯å®¹å™¨ -->
  <div class="gradient-wrap">
    <main class="container py-3">
      <div class="row g-3">
        <div class="col-lg-8">
          <h4 class="mb-3">å•†å“åˆ—è¡¨</h4>
          <div id="products" class="grid"></div>
        </div>

        <div class="col-lg-4">
          <div class="card aside p-3 cart-box">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h5 class="m-0">è³¼ç‰©è»Š</h5>
              <button id="btnClear" class="btn btn-sm">æ¸…ç©º</button>
            </div>
            <div id="cartItems" class="small text-muted">å°šç„¡å•†å“</div>
            <hr>
            <div class="d-flex justify-content-between">
              <div class="text-muted">å°è¨ˆ</div><div id="subtotal" class="fw-bold">NT$ 0</div>
            </div>
            <div class="d-flex justify-content-between">
              <div class="text-muted">é‹è²»</div><div id="shipping" class="fw-bold">NT$ 0</div>
            </div>
            <div class="d-flex justify-content-between fs-5">
              <div>åˆè¨ˆ</div><div id="total" class="fw-bold">NT$ 0</div>
            </div>
            <div class="d-grid mt-2">
              <button id="btnCheckout" class="btn btn-primary">çµå¸³</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- çµå¸³ Modalï¼ˆåŸæ¨£ä¿ç•™ï¼‰ -->
  <div class="modal fade" id="checkoutDlg" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <form id="checkoutForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">è¨‚è³¼è³‡æ–™</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row g-2">
            <div class="col-md-6">
              <label class="form-label">å§“å</label>
              <input name="name" class="form-control" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">é›»è©±</label>
              <input name="phone" class="form-control" required>
            </div>
          </div>
          <div class="mt-2">
            <label class="form-label">Emailï¼ˆæ”¶è¨‚å–®ï¼‰</label>
            <input name="email" type="email" class="form-control" required>
          </div>
          <div class="mt-2">
            <label class="form-label">é…é€æ–¹å¼</label>
            <select name="shipping" class="form-select" required>
              <option value="å®…é…">å®…é…ï¼ˆé»‘è²“/æ–°ç«¹ï¼‰</option>
              <option value="è¶…å•†å–è²¨ï¼ˆå…ˆåŒ¯æ¬¾ï¼‰">è¶…å•†å–è²¨ï¼ˆå…ˆåŒ¯æ¬¾ï¼‰</option>
            </select>
          </div>
          <div class="mt-2">
            <label class="form-label">åœ°å€/é–€å¸‚</label>
            <input name="address" class="form-control" required>
          </div>
          <div class="mt-2">
            <label class="form-label">ä»˜æ¬¾æ–¹å¼</label>
            <select name="payment" class="form-select" required>
              <option value="éŠ€è¡Œè½‰å¸³">éŠ€è¡Œè½‰å¸³</option>
              <option value="è²¨åˆ°ä»˜æ¬¾">è²¨åˆ°ä»˜æ¬¾</option>
              <option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡ï¼ˆç¶ ç•Œ/è—æ–°ï¼‰</option>
            </select>
          </div>
          <div class="mt-2">
            <label class="form-label">å‚™è¨»</label>
            <textarea name="note" rows="3" class="form-control" placeholder="å°ºå¯¸ã€ç™¼ç¥¨æŠ¬é ­/çµ±ç·¨ç­‰"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal" type="button">å–æ¶ˆ</button>
          <button class="btn btn-primary" type="submit">é€å‡ºè¨‚å–®</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script type="module">
    import { db } from './assets/js/firebase.js';
    import { collection, addDoc, serverTimestamp }
      from 'https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js';

    const PRODUCTS = [
      { name:'SuperTool Premium 7å¤©', price:50 },
      { name:'SuperTool Premium 30å¤©', price:100 },
      { name:'SuperTool Premium 365å¤©', price:800 },
      { name:'è´ŠåŠ©é–‹ç™¼è€…ä¸€æ¯å’–å•¡', price:50 },
      { name:'è´ŠåŠ©é–‹ç™¼è€…ä¸€å€‹ä¾¿ç•¶', price:100 },
      { name:'è´ŠåŠ©é–‹ç™¼è€…å…©å€‹ä¾¿ç•¶', price:200 },
    ];

    const CART_KEY = 'cart';
    const $ = sel => document.querySelector(sel);
    const fmt = n => 'NT$ ' + (n||0).toLocaleString();

    const loadCart = () => { try { return JSON.parse(localStorage.getItem(CART_KEY)||'[]'); } catch { return []; } };
    const saveCart = (c) => localStorage.setItem(CART_KEY, JSON.stringify(c));
    const clearCart = () => localStorage.removeItem(CART_KEY);

    function addToCart(p){
      const cart = loadCart();
      const f = cart.find(i=>i.name===p.name);
      if (f) f.qty++;
      else cart.push({ name:p.name, price:p.price, qty:1 });
      saveCart(cart);
      renderCart();
    }
    window.changeQty = changeQty;
    function changeQty(name, delta){
      const cart = loadCart();
      const i = cart.find(x=>x.name===name);
      if (!i) return;
      i.qty += delta;
      if (i.qty <= 0) cart.splice(cart.indexOf(i),1);
      saveCart(cart);
      renderCart();
    }

    function renderProducts(){
      document.getElementById('products').innerHTML = PRODUCTS.map(p=>`
        <div class="card p-3 product-card">
          <div class="fw-semibold">${p.name}</div>
          <div class="price mt-1">NT$ ${p.price.toLocaleString()}</div>
          <button class="btn btn-sm mt-2" onclick='addToCart(${JSON.stringify(p)})'>åŠ å…¥è³¼ç‰©è»Š</button>
        </div>
      `).join('');
      window.addToCart = addToCart;

      // å¥—ç”¨å½©è‰²ä¸»é¡Œï¼ˆä¾åºè¼ªæ›¿ st-g1~st-g8ï¼‰
      const grads = ['st-g1','st-g2','st-g3','st-g4','st-g5','st-g6','st-g7','st-g8'];
      document.querySelectorAll('.product-card').forEach((el,i)=>{
        el.classList.add('st-colored-card', grads[i % grads.length]);
      });

      // ğŸ›’ è³¼ç‰©è»Šå¡ç‰‡ä¹Ÿå¥—ç”¨å½©è‰²ä¸»é¡Œï¼ˆå›ºå®šç”¨ st-g6ï¼Œé¿å…é»ƒè‰²æ¬¾çš„æ·±å­—å•é¡Œï¼‰
      const cartEl = document.querySelector('.cart-box');
      if(cartEl){ cartEl.classList.add('st-colored-card','st-g6'); }
    }

    function renderCart(){
      const cart = loadCart();
      const wrap = document.getElementById('cartItems');
      wrap.innerHTML = cart.length
        ? cart.map(i=>`
          <div class="d-flex justify-content-between align-items-center py-1 cart-item">
            <div>${i.name}</div>
            <div class="d-flex align-items-center gap-2">
              <button class="btn btn-sm" onclick="changeQty('${i.name}',-1)">ï¼</button>
              <span>${i.qty}</span>
              <button class="btn btn-sm" onclick="changeQty('${i.name}',+1)">ï¼‹</button>
              <div class="ms-2">${fmt(i.price*i.qty)}</div>
            </div>
          </div>
        `).join('')
        : '<div class="text-muted">å°šç„¡å•†å“</div>';

      const subtotal = cart.reduce((s,i)=> s + i.price*i.qty, 0);

      // âœ… æœ‰ä»»ä½•ã€ŒSuperTool Premiumã€å°±å…é‹
      const hasPremium = cart.some(i => i.name.startsWith('SuperTool Premium'));
      const shipping = (cart.length === 0) ? 0 : (hasPremium ? 0 : (subtotal > 2000 ? 0 : 100));

      document.getElementById('subtotal').textContent = fmt(subtotal);
      document.getElementById('shipping').textContent = fmt(shipping);
      document.getElementById('total').textContent = fmt(subtotal+shipping);
    }

    document.getElementById('btnClear').addEventListener('click', ()=>{ clearCart(); renderCart(); });
    document.getElementById('btnCheckout').addEventListener('click', ()=>{
      if (!loadCart().length) { alert('è³¼ç‰©è»Šæ˜¯ç©ºçš„'); return; }
      new bootstrap.Modal('#checkoutDlg').show();
    });

    document.getElementById('checkoutForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const cart = loadCart();
      if (!cart.length){ alert('è³¼ç‰©è»Šæ˜¯ç©ºçš„'); return; }

      const data = Object.fromEntries(new FormData(e.target).entries());
      const subtotal = cart.reduce((s,i)=> s + i.price*i.qty, 0);

      const hasPremium = cart.some(i => i.name.startsWith('SuperTool Premium'));
      const shipping = (cart.length === 0) ? 0 : (hasPremium ? 0 : (subtotal > 2000 ? 0 : 100));

      const total = subtotal + shipping;

      const order = {
        customer: data,
        items: cart,
        amounts: { subtotal, shipping, total },
        status: 'pending',
        createdAt: serverTimestamp()
      };

      try{
        const ref = await addDoc(collection(db,'orders'), order);
        alert(`è¨‚å–®å·²é€å‡ºï¼š${ref.id}`);
        clearCart();
        renderCart();
        bootstrap.Modal.getInstance(document.getElementById('checkoutDlg')).hide();
      }catch(err){
        console.error(err);
        alert('å¯«å…¥è¨‚å–®å¤±æ•—ï¼š' + err.message);
      }
    });

    document.getElementById('toggleTheme').addEventListener('click', ()=>{
      document.body.classList.toggle('light');
      document.documentElement.classList.toggle('light');
    });

    renderProducts();
    renderCart();
  </script>

  <script>
    // æ‰‹æ©Ÿæ¼¢å ¡é¸å–®æ§åˆ¶ï¼ˆè·Ÿé¦–é ä¸€æ¨£ï¼‰
    (function(){
      const toggle = document.getElementById('menuToggle');
      const nav = document.getElementById('mainNav');
      if(!toggle || !nav) return;

      const mq = window.matchMedia('(max-width: 768px)');

      function closeMenu(){
        nav.classList.remove('open');
        toggle.classList.remove('active');
        toggle.setAttribute('aria-expanded','false');
      }

      toggle.addEventListener('click', ()=>{
        const opened = nav.classList.toggle('open');
        toggle.classList.toggle('active', opened);
        toggle.setAttribute('aria-expanded', opened ? 'true' : 'false');
      });

      window.addEventListener('resize', ()=>{ if(!mq.matches) closeMenu(); });

      document.addEventListener('click', (e)=>{
        if (!mq.matches) return;
        if (e.target === toggle || toggle.contains(e.target)) return;
        if (!nav.contains(e.target)) closeMenu();
      });
    })();
  </script>
</body>
</html>

