<!doctype html><html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SuperTool Site</title>
<link rel="manifest" href="manifest.json"/>
<link rel="icon" href="assets/img/icon-192.png"/>
<link rel="stylesheet" href="assets/css/style.css"/>
<script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
  <style>
  #onetap-anchor{position:fixed;top:6px;left:8px;z-index:9999}
  .welcome-chip{
    display:inline-flex;align-items:center;gap:.4rem;
    background:#ffffff; color:#111; border-radius:999px;
    padding:.35rem .7rem; font-weight:700; box-shadow:0 2px 8px #0003;
  }
</style>
<div id="onetap-anchor"></div>
<body>
  <!-- æ”¾åœ¨ <head> çµæŸå‰æˆ– <body> é–‹é ­éƒ½å¯ä»¥ -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<!-- é¡¯ç¤º Google ç™»å…¥æŒ‰éˆ• -->
<div class="g_id_signin"
     data-type="standard"
     data-shape="rectangular"
     data-theme="outline"
     data-text="sign_in_with"
     data-size="large"
     data-logo_alignment="left"></div>

<script>
  // è®€å–/å¯«å…¥ä½¿ç”¨è€…
  function getUser(){ try{ return JSON.parse(localStorage.getItem('session_user')||'null'); }catch{return null;} }
  function showWelcomeChip(name){
    const anchor = document.getElementById('onetap-anchor');
    anchor.innerHTML = `<div class="welcome-chip">ğŸ‘‹ æ­¡è¿ ${name}</div>`;
  }

  // Google å›å‚³ credential å¾ŒåŸ·è¡Œï¼ˆå«æ­£ç¢ºçš„ä¸­æ–‡è§£ç¢¼ï¼‰
  function handleCredentialResponse(response){
    try{
      const token = response.credential;
      const base64Url = token.split('.')[1];
      const base64    = base64Url.replace(/-/g,'+').replace(/_/g,'/');
      const json = decodeURIComponent(
        atob(base64).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join('')
      );
      const payload = JSON.parse(json);

      const user = {
        email:   payload.email,
        name:    payload.name,
        picture: payload.picture,
        sub:     payload.sub
      };
      localStorage.setItem('session_user', JSON.stringify(user));

      // ç™»å…¥å¾Œï¼šé—œé–‰ One-Tap ä¸¦é¡¯ç¤ºæ­¡è¿
      try{ google.accounts.id.cancel(); }catch(e){}
      showWelcomeChip(user.name);

      // è®“ä½ çš„ app è®€åˆ°æ–° sessionï¼ˆè‹¥ä¸éœ€è¦å¯ç§»é™¤ï¼‰
      location.hash = '#dashboard';
      location.reload();
    }catch(e){
      console.error('è§£æ Google Token éŒ¯èª¤ï¼š', e);
    }
  }

  // ===== åˆå§‹åŒ–ï¼ˆé—œéµï¼‰=====
  window.addEventListener('load', () => {
    // å…ˆæ¸…é™¤è‡ªå‹•é¸å–ç‹€æ…‹ï¼Œé¿å…æ®˜ç•™
    try{ google.accounts.id.disableAutoSelect(); }catch(e){}

    // åˆå§‹åŒ–ï¼šä¸è¦ auto_selectï¼Œcallback æŒ‡å‘ä¸Šé¢é‚£å€‹å‡½å¼
    google.accounts.id.initialize({
      client_id: "225238850447-tds4p75o2nsforov086amnrj1nha7tuh.apps.googleusercontent.com",
      callback: handleCredentialResponse,
      auto_select: false,
      cancel_on_tap_outside: true
    });

    const user = getUser();
    if (user && user.name){
      // å·²ç™»å…¥ï¼šä¸é¡¯ç¤º One-Tapï¼Œç›´æ¥é¡¯ç¤ºæ­¡è¿å¾½ç« 
      showWelcomeChip(user.name);
    }else{
      // æœªç™»å…¥ï¼šå«å‡º One-Tap å°è† å›Š
      google.accounts.id.prompt();
    }
  });

  <script>
  // åªè¦ hash æ›é ä¸”æœªç™»å…¥ï¼Œå°±å†å˜—è©¦å«å‡º One-Tap
  window.addEventListener('hashchange', () => {
    try {
      const user = JSON.parse(localStorage.getItem('session_user') || 'null');
      if (!user) { google.accounts.id.prompt(); }
    } catch {}
  });
</script>


<header class="top">
  <div class="brand">SuperTool</div>
  <nav class="nav">
    <button data-route="dashboard">é¦–é </button>
    <button data-route="auth">å¸³è™Ÿ</button>
    <button data-route="expense">æ”¯å‡º</button>
    <button data-route="acct_mine">æˆ‘çš„</button>
    <button data-route="acct_detail">æ˜ç´°</button>
    <button data-route="acct_analysis">åˆ†æ</button>
    <button data-route="chatbook">èŠå¤©è¨˜å¸³</button>
    <button data-route="camera">æ‹ç…§è¨˜å¸³</button>
    <button data-route="shop">è³¼ç‰©</button>
    <button data-route="admin">å¾Œå°</button>
    <button data-route="settings">è¨­å®š</button>
    <button data-route="backup">å‚™ä»½</button>
  </nav>
</header>
  <style>
  #onetap-anchor{position:fixed;top:6px;left:8px;z-index:9999}
  .welcome-chip{
    display:inline-flex;align-items:center;gap:.4rem;
    background:#ffffff; color:#111; border-radius:999px;
    padding:.35rem .7rem; font-weight:700; box-shadow:0 2px 8px #0003;
  }
</style>
<div id="onetap-anchor"></div>

<main id="app"></main>

<button id="fabExpense" class="fab">ï¼‹</button>
<button id="fabShop" class="fab-square">ğŸ›’</button>

<script type="module" src="assets/js/app.js"></script>
<script>
if('serviceWorker' in navigator){ navigator.serviceWorker.register('service-worker.js'); }
</script>
</body></html>
