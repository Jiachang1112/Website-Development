<!doctype html><html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SuperTool Site</title>
<link rel="manifest" href="manifest.json"/>
<link rel="icon" href="assets/img/icon-192.png"/>
<link rel="stylesheet" href="assets/css/style.css"/>
<script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <!-- 放在 <head> 結束前或 <body> 開頭都可以 -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<!-- 初始化：只要填 Client ID，不要 data-login_uri -->
<div id="g_id_onload"
     data-client_id="225238850447-tds4p75o2nsforov086amnrj1nha7tuh.apps.googleusercontent.com"
     data-auto_prompt="false"
     data-callback="handleCredentialResponse"></div>

<!-- 顯示 Google 登入按鈕 -->
<div class="g_id_signin"
     data-type="standard"
     data-shape="rectangular"
     data-theme="outline"
     data-text="sign_in_with"
     data-size="large"
     data-logo_alignment="left"></div>

<script>
  // Google 回傳 credential（JWT）後會呼叫這個函式
  window.handleCredentialResponse = (response) => {
    try {
      const token = response.credential;
      const base64Url = token.split('.')[1];
const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
const json = decodeURIComponent(
  atob(base64)
    .split('')
    .map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))
    .join('')
);
const payload = JSON.parse(json);
      // 存成你的 session（app.js 會讀這個）
      const user = {
        email: payload.email,
        name: payload.name,
        picture: payload.picture,
        sub: payload.sub
      };
      localStorage.setItem('session_user', JSON.stringify(user));
      // 登入完成 → 回首頁或直接跳後台
      location.hash = '#dashboard';
      location.reload();
    } catch (e) {
      alert('Google 登入解析失敗：' + e);
    }
  };
</script>

<header class="top">
  <div class="brand">SuperTool</div>
  <nav class="nav">
    <button data-route="dashboard">首頁</button>
    <button data-route="auth">帳號</button>
    <button data-route="expense">支出</button>
    <button data-route="acct_mine">我的</button>
    <button data-route="acct_detail">明細</button>
    <button data-route="acct_analysis">分析</button>
    <button data-route="chatbook">聊天記帳</button>
    <button data-route="camera">拍照記帳</button>
    <button data-route="shop">購物</button>
    <button data-route="admin">後台</button>
    <button data-route="settings">設定</button>
    <button data-route="backup">備份</button>
  </nav>
</header>
<main id="app"></main>

<button id="fabExpense" class="fab">＋</button>
<button id="fabShop" class="fab-square">🛒</button>

<script type="module" src="assets/js/app.js"></script>
<script>
if('serviceWorker' in navigator){ navigator.serviceWorker.register('service-worker.js'); }
</script>
</body></html>
