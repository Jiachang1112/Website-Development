<!doctype html><html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SuperTool Site</title>
<link rel="manifest" href="manifest.json"/>
<link rel="icon" href="assets/img/icon-192.png"/>
<link rel="stylesheet" href="assets/css/style.css"/>
<script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <!-- æ”¾åœ¨ <head> çµæŸå‰æˆ– <body> é–‹é ­éƒ½å¯ä»¥ -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<!-- åˆå§‹åŒ–ï¼šåªè¦å¡« Client IDï¼Œä¸è¦ data-login_uri -->
<div id="g_id_onload"
     data-client_id="225238850447-tds4p75o2nsforov086amnrj1nha7tuh.apps.googleusercontent.com"
     data-auto_prompt="false"
     data-callback="handleCredentialResponse"></div>

<!-- é¡¯ç¤º Google ç™»å…¥æŒ‰éˆ• -->
<div class="g_id_signin"
     data-type="standard"
     data-shape="rectangular"
     data-theme="outline"
     data-text="sign_in_with"
     data-size="large"
     data-logo_alignment="left"></div>

<script>
  // Google å›å‚³ credentialï¼ˆJWTï¼‰å¾Œæœƒå‘¼å«é€™å€‹å‡½å¼
  window.handleCredentialResponse = (response) => {
    try {
      const token = response.credential;
      const base64Url = token.split('.')[1];
const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
const json = decodeURIComponent(
  atob(base64)
    .split('')
    .map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))
    .join('')
);
const payload = JSON.parse(json);
      // å­˜æˆä½ çš„ sessionï¼ˆapp.js æœƒè®€é€™å€‹ï¼‰
      const user = {
        email: payload.email,
        name: payload.name,
        picture: payload.picture,
        sub: payload.sub
      };
      localStorage.setItem('session_user', JSON.stringify(user));
      // ç™»å…¥å®Œæˆ â†’ å›é¦–é æˆ–ç›´æ¥è·³å¾Œå°
      location.hash = '#dashboard';
      location.reload();
    } catch (e) {
      alert('Google ç™»å…¥è§£æå¤±æ•—ï¼š' + e);
    }
  };
</script>

<header class="top">
  <div class="brand">SuperTool</div>
  <nav class="nav">
    <button data-route="dashboard">é¦–é </button>
    <button data-route="auth">å¸³è™Ÿ</button>
    <button data-route="expense">æ”¯å‡º</button>
    <button data-route="acct_mine">æˆ‘çš„</button>
    <button data-route="acct_detail">æ˜ç´°</button>
    <button data-route="acct_analysis">åˆ†æ</button>
    <button data-route="chatbook">èŠå¤©è¨˜å¸³</button>
    <button data-route="camera">æ‹ç…§è¨˜å¸³</button>
    <button data-route="shop">è³¼ç‰©</button>
    <button data-route="admin">å¾Œå°</button>
    <button data-route="settings">è¨­å®š</button>
    <button data-route="backup">å‚™ä»½</button>
  </nav>
</header>
<main id="app"></main>

<button id="fabExpense" class="fab">ï¼‹</button>
<button id="fabShop" class="fab-square">ğŸ›’</button>

<script type="module" src="assets/js/app.js"></script>
<script>
if('serviceWorker' in navigator){ navigator.serviceWorker.register('service-worker.js'); }
</script>
</body></html>
